<div class="container mt-4">
  <div class="row">
    <!-- Account Search & Details -->
    <div class="col-md-7">
      <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-wallet2 me-2"></i>Account Details</h5>
        </div>
        <div class="card-body">
          <form [formGroup]="accountFormGroup" (ngSubmit)="handleSearchAccount()">
            <div class="input-group mb-3">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" formControlName="accountId" class="form-control" 
                     placeholder="Enter Account ID...">
              <button class="btn btn-info" type="submit">
                <i class="bi bi-search me-1"></i> Search
              </button>
            </div>
          </form>

          <div *ngIf="errorMessage" class="alert alert-danger">
            <i class="bi bi-exclamation-triangle me-2"></i>{{errorMessage}}
          </div>

          <ng-container *ngIf="accountObservable | async as accountDetails">
            <!-- Account Info Cards -->
            <div class="row mb-3">
              <div class="col-6">
                <div class="card bg-light">
                  <div class="card-body text-center">
                    <small class="text-muted">Account ID</small>
                    <p class="mb-0"><code>{{accountDetails.accountId | slice:0:20}}...</code></p>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="card bg-success text-white">
                  <div class="card-body text-center">
                    <small>Current Balance</small>
                    <h4 class="mb-0">{{accountDetails.balance | number:'1.2-2'}} DH</h4>
                  </div>
                </div>
              </div>
            </div>

            <!-- Operations History -->
            <h6 class="mt-4 mb-3">
              <i class="bi bi-clock-history me-2"></i>Operations History
            </h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <thead class="table-secondary">
                  <tr>
                    <th>ID</th>
                    <th>Date</th>
                    <th>Type</th>
                    <th class="text-end">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let op of accountDetails.accountOperationDTOS">
                    <td><small class="text-muted">#{{op.id}}</small></td>
                    <td>{{op.operationDate | date:'dd/MM/yyyy HH:mm'}}</td>
                    <td>
                      <span [class]="op.type === 'CREDIT' ? 'badge bg-success' : 'badge bg-danger'">
                        <i [class]="op.type === 'CREDIT' ? 'bi bi-arrow-down-circle' : 'bi bi-arrow-up-circle'"></i>
                        {{op.type}}
                      </span>
                    </td>
                    <td class="text-end" [class]="op.type === 'CREDIT' ? 'text-success' : 'text-danger'">
                      {{op.type === 'CREDIT' ? '+' : '-'}}{{op.amount | number:'1.2-2'}} DH
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <nav *ngIf="accountDetails.totalPages > 1">
              <ul class="pagination pagination-sm justify-content-center">
                <li class="page-item" [class.disabled]="currentPage === 0">
                  <a class="page-link" (click)="gotoPage(currentPage - 1)">Previous</a>
                </li>
                <li class="page-item" *ngFor="let p of [].constructor(accountDetails.totalPages); let i = index"
                    [class.active]="i === currentPage">
                  <a class="page-link" (click)="gotoPage(i)">{{i + 1}}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === accountDetails.totalPages - 1">
                  <a class="page-link" (click)="gotoPage(currentPage + 1)">Next</a>
                </li>
              </ul>
            </nav>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- Operations Panel -->
    <div class="col-md-5">
      <div class="card shadow" *ngIf="accountObservable">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-cash-stack me-2"></i>New Operation</h5>
        </div>
        <div class="card-body">
          <form [formGroup]="operationFromGroup" (ngSubmit)="handleAccountOperation()">
            <!-- Operation Type -->
            <div class="mb-3">
              <label class="form-label fw-bold">Operation Type</label>
              <div class="btn-group w-100" role="group">
                <input type="radio" class="btn-check" formControlName="operationType" 
                       value="DEBIT" id="debit">
                <label class="btn btn-outline-danger" for="debit">
                  <i class="bi bi-arrow-up-circle me-1"></i> DEBIT
                </label>

                <input type="radio" class="btn-check" formControlName="operationType" 
                       value="CREDIT" id="credit">
                <label class="btn btn-outline-success" for="credit">
                  <i class="bi bi-arrow-down-circle me-1"></i> CREDIT
                </label>

                <input type="radio" class="btn-check" formControlName="operationType" 
                       value="TRANSFER" id="transfer">
                <label class="btn btn-outline-primary" for="transfer">
                  <i class="bi bi-arrow-left-right me-1"></i> TRANSFER
                </label>
              </div>
            </div>

            <!-- Destination Account (for Transfer) -->
            <div class="mb-3" *ngIf="operationFromGroup.value.operationType === 'TRANSFER'">
              <label class="form-label">Destination Account</label>
              <input type="text" formControlName="accountDestination" class="form-control"
                     placeholder="Enter destination account ID">
            </div>

            <!-- Amount -->
            <div class="mb-3">
              <label class="form-label">Amount (DH)</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-currency-dollar"></i></span>
                <input type="number" formControlName="amount" class="form-control" 
                       placeholder="0.00" min="0" step="0.01">
              </div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea formControlName="description" class="form-control" rows="2"
                        placeholder="Enter operation description..."></textarea>
            </div>

            <!-- Submit Button -->
            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-check-circle me-2"></i>Execute Operation
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Help Card -->
      <div class="card shadow mt-3" *ngIf="!accountObservable">
        <div class="card-body text-center text-muted">
          <i class="bi bi-info-circle fs-1 mb-3"></i>
          <p>Enter an Account ID to view details and perform operations.</p>
        </div>
      </div>
    </div>
  </div>
</div>
