<div class="container py-4">
  <div class="row g-4">
    <!-- Account Search & Details -->
    <div class="col-lg-7">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white py-3">
          <h5 class="mb-0 fw-bold text-dark"><i class="bi bi-search me-2 text-primary"></i>Find Account</h5>
        </div>
        <div class="card-body">
          <form [formGroup]="accountFormGroup" (ngSubmit)="handleSearchAccount()">
            <div class="input-group mb-3 shadow-sm rounded">
              <span class="input-group-text bg-white border-end-0"><i class="bi bi-hash text-muted"></i></span>
              <input type="text" formControlName="accountId" class="form-control border-start-0 ps-0"
                     placeholder="Enter Account ID (e.g. 7f0a...)">
              <button class="btn btn-primary px-4" type="submit">
                Search
              </button>
            </div>
          </form>

          <div *ngIf="errorMessage" class="alert alert-danger border-0 shadow-sm small">
            <i class="bi bi-exclamation-circle-fill me-2"></i>{{errorMessage}}
          </div>

          <ng-container *ngIf="accountObservable | async as accountDetails">
            <!-- Account Info Cards -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <div class="card bg-light border-0">
                  <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                      <div class="bg-white rounded p-2 me-3 shadow-sm">
                        <i class="bi bi-fingerprint text-primary fs-4"></i>
                      </div>
                      <div>
                        <small class="text-muted d-block">Account ID</small>
                        <span class="fw-bold text-dark small">{{accountDetails.accountId | slice:0:15}}...</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card bg-primary text-white border-0">
                  <div class="card-body p-3">
                    <div class="d-flex align-items-center">
                      <div class="bg-white bg-opacity-25 rounded p-2 me-3">
                        <i class="bi bi-currency-dollar fs-4"></i>
                      </div>
                      <div>
                        <small class="text-white text-opacity-75 d-block">Current Balance</small>
                        <span class="fw-bold fs-5">{{accountDetails.balance | number:'1.2-2'}} DH</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Operations History -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="fw-bold mb-0 text-dark">
                <i class="bi bi-clock-history me-2 text-primary"></i>Recent Operations
              </h6>
              <span class="badge bg-light text-dark border">{{accountDetails.accountOperationDTOS.length}} items</span>
            </div>
            <div class="table-responsive rounded shadow-sm border">
              <table class="table table-sm table-hover mb-0">
                <thead class="bg-light">
                  <tr>
                    <th class="ps-3 py-2">Date</th>
                    <th class="py-2">Type</th>
                    <th class="text-end pe-3 py-2">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let op of accountDetails.accountOperationDTOS">
                    <td class="ps-3"><small class="text-muted">{{op.operationDate | date:'dd MMM yyyy HH:mm'}}</small></td>
                    <td>
                      <span [class]="op.type === 'CREDIT' ? 'badge bg-success bg-opacity-10 text-success' : 'badge bg-danger bg-opacity-10 text-danger'">
                        {{op.type}}
                      </span>
                    </td>
                    <td class="text-end pe-3">
                      <span [class]="op.type === 'CREDIT' ? 'fw-bold text-success' : 'fw-bold text-danger'">
                        {{op.type === 'CREDIT' ? '+' : '-'}}{{op.amount | number:'1.2-2'}}
                      </span>
                      <small class="text-muted ms-1">DH</small>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            <nav *ngIf="accountDetails.totalPages > 1" class="mt-4">
              <ul class="pagination pagination-sm justify-content-center">
                <li class="page-item" [class.disabled]="currentPage === 0">
                  <button class="page-link" (click)="gotoPage(currentPage - 1)">Prev</button>
                </li>
                <li class="page-item" *ngFor="let p of [].constructor(accountDetails.totalPages); let i = index"
                    [class.active]="i === currentPage">
                  <button class="page-link" (click)="gotoPage(i)">{{i + 1}}</button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === accountDetails.totalPages - 1">
                  <button class="page-link" (click)="gotoPage(currentPage + 1)">Next</button>
                </li>
              </ul>
            </nav>
          </ng-container>

          <div *ngIf="!accountObservable && !errorMessage" class="text-center py-5">
            <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
              <i class="bi bi-search text-muted fs-1"></i>
            </div>
            <p class="text-muted">Enter an account ID above to view details</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Operations Panel -->
    <div class="col-lg-5">
      <div class="card border-0 shadow-sm" *ngIf="accountObservable | async as accountDetails">
        <div class="card-header bg-white py-3">
          <h5 class="mb-0 fw-bold text-dark"><i class="bi bi-lightning-fill me-2 text-warning"></i>Quick Action</h5>
        </div>
        <div class="card-body">
          <div *ngIf="accountDetails.status && accountDetails.status.toString() !== 'ACTIVATED'" class="alert alert-warning border-0 shadow-sm small mb-4">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Operations are disabled because this account is <strong>{{accountDetails.status}}</strong>.
            Please activate it to perform transactions.
          </div>

          <form [formGroup]="operationFromGroup" (ngSubmit)="handleAccountOperation()" [class.opacity-50]="accountDetails.status && accountDetails.status.toString() !== 'ACTIVATED'" [style.pointer-events]="accountDetails.status && accountDetails.status.toString() !== 'ACTIVATED' ? 'none' : 'auto'">
            <!-- Operation Type -->
            <div class="mb-4">
              <label class="form-label small fw-bold text-muted text-uppercase mb-3">Select Operation</label>
              <div class="row g-2">
                <div class="col-4">
                  <input type="radio" class="btn-check" formControlName="operationType" value="DEBIT" id="debit" autocomplete="off">
                  <label class="btn btn-outline-danger w-100 py-3 d-flex flex-column align-items-center" for="debit">
                    <i class="bi bi-dash-circle fs-4 mb-1"></i>
                    <span class="small fw-bold">DEBIT</span>
                  </label>
                </div>
                <div class="col-4">
                  <input type="radio" class="btn-check" formControlName="operationType" value="CREDIT" id="credit" autocomplete="off">
                  <label class="btn btn-outline-success w-100 py-3 d-flex flex-column align-items-center" for="credit">
                    <i class="bi bi-plus-circle fs-4 mb-1"></i>
                    <span class="small fw-bold">CREDIT</span>
                  </label>
                </div>
                <div class="col-4">
                  <input type="radio" class="btn-check" formControlName="operationType" value="TRANSFER" id="transfer" autocomplete="off">
                  <label class="btn btn-outline-primary w-100 py-3 d-flex flex-column align-items-center" for="transfer">
                    <i class="bi bi-send fs-4 mb-1"></i>
                    <span class="small fw-bold">SEND</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- Destination Account (for Transfer) -->
            <div class="mb-3 animate__animated animate__fadeIn" *ngIf="operationFromGroup.value.operationType === 'TRANSFER'">
              <label class="form-label small fw-bold">Recipient Account ID</label>
              <div class="input-group input-group-sm">
                <span class="input-group-text bg-white"><i class="bi bi-person-badge text-muted"></i></span>
                <input type="text" formControlName="accountDestination" class="form-control"
                       placeholder="Enter destination account ID">
              </div>
            </div>

            <!-- Amount -->
            <div class="mb-3">
              <label class="form-label small fw-bold">Amount to Process</label>
              <div class="input-group">
                <span class="input-group-text bg-white fw-bold">DH</span>
                <input type="number" formControlName="amount" class="form-control fw-bold"
                       placeholder="0.00" min="0" step="0.01">
              </div>
            </div>

            <!-- Description -->
            <div class="mb-4">
              <label class="form-label small fw-bold">Notes (Optional)</label>
              <textarea formControlName="description" class="form-control small" rows="2"
                        placeholder="Add a reference for this operation..."></textarea>
            </div>

            <!-- Submit Button -->
            <div class="d-grid">
              <button [disabled]="accountDetails.status && accountDetails.status.toString() !== 'ACTIVATED'" type="submit" class="btn btn-primary btn-sm py-2 fw-bold shadow-sm">
                Confirm Transaction <i class="bi bi-check2-circle ms-1"></i>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Help Card when no account is selected -->
      <div class="card border-0 shadow-sm bg-primary text-white" *ngIf="!(accountObservable | async)">
        <div class="card-body p-4 text-center">
          <i class="bi bi-info-circle fs-1 mb-3 opacity-50"></i>
          <h5 class="fw-bold">Ready to transact?</h5>
          <p class="small opacity-75">Once you find an account, you'll be able to perform debits, credits, and transfers instantly.</p>
        </div>
      </div>
    </div>
  </div>
</div>
