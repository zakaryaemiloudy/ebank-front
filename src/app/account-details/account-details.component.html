<div class="container py-4">
  <div class="card border-0 shadow-sm" *ngIf="account$ | async as account; else loadingOrError">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
      <h5 class="mb-0 fw-bold text-dark">
        <i class="bi bi-gear-fill me-2 text-primary"></i>Product Management
      </h5>
      <a [routerLink]="['/customer-accounts', account.customerDTO.id]" class="btn btn-light btn-sm px-3 fw-bold text-muted">
        <i class="bi bi-arrow-left me-1"></i> Portfolio
      </a>
    </div>
    <div class="card-body p-4">
      <div class="row g-4">
        <div class="col-lg-7">
          <div class="d-flex align-items-center mb-4">
            <div [class]="account.type === 'SavingAccount' ? 'bg-success bg-opacity-10 text-success' : 'bg-primary bg-opacity-10 text-primary'"
                 class="rounded-circle p-3 me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
              <i [class]="account.type === 'SavingAccount' ? 'bi bi-piggy-bank fs-2' : 'bi bi-credit-card fs-2'"></i>
            </div>
            <div>
              <h4 class="fw-bold text-dark mb-0">{{account.type === 'SavingAccount' ? 'Saving Account' : 'Current Account'}}</h4>
              <code class="extra-small text-muted">{{account.id}}</code>
            </div>
          </div>

          <div class="row g-3">
            <div class="col-sm-6">
              <div class="p-3 bg-light rounded">
                <small class="text-muted d-block text-uppercase extra-small fw-bold mb-1">Customer</small>
                <div class="fw-bold text-dark">{{account.customerDTO.name}}</div>
                <small class="text-muted">{{account.customerDTO.email}}</small>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="p-3 bg-light rounded h-100">
                <small class="text-muted d-block text-uppercase extra-small fw-bold mb-1">Status</small>
                <span class="badge" [ngClass]="getBadgeClass(account.status)">
                  {{account.status}}
                </span>
                <div class="extra-small text-muted mt-2">Opened {{account.createdAt | date:'mediumDate'}}</div>
              </div>
            </div>
            <div class="col-12">
              <div class="p-4 bg-dark text-white rounded shadow-sm d-flex justify-content-between align-items-center">
                <div>
                  <small class="text-white text-opacity-50 text-uppercase extra-small fw-bold d-block mb-1">Available Balance</small>
                  <h2 class="mb-0 fw-bold">{{account.balance | number:'1.2-2'}} <small class="fs-6 fw-normal text-opacity-75">DH</small></h2>
                </div>
                <div class="text-end">
                  <div *ngIf="account.type === 'SavingAccount'">
                    <small class="text-white text-opacity-50 text-uppercase extra-small fw-bold d-block mb-1">Yield</small>
                    <span class="fw-bold text-success">+{{account.interestRate}}% APY</span>
                  </div>
                  <div *ngIf="account.type === 'CurrentAccount'">
                    <small class="text-white text-opacity-50 text-uppercase extra-small fw-bold d-block mb-1">Facility</small>
                    <span class="fw-bold text-info">{{account.overDraft | number:'1.2-2'}} DH</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="card bg-light border-0 h-100">
            <div class="card-body p-4 d-flex flex-column justify-content-center">
              <h6 class="fw-bold text-dark text-center mb-4 text-uppercase small letter-spacing-1">Control Center</h6>

              <div *ngIf="account.status.toString() === 'CREATED'" class="alert bg-white border-0 shadow-sm mb-4">
                <div class="d-flex">
                  <i class="bi bi-info-circle-fill text-info me-3 fs-4"></i>
                  <small class="text-muted">This account is awaiting initial activation to start processing transactions.</small>
                </div>
              </div>

              <div class="d-grid gap-3">
                <button type="button" class="btn btn-sm py-3 fw-bold shadow-sm d-flex align-items-center justify-content-center"
                        [ngClass]="account.status && account.status.toString() === 'ACTIVATED' ? 'btn-outline-danger' : 'btn-success'"
                        (click)="handleToggleStatus(account.status)">
                  <i class="bi me-2 fs-5" [ngClass]="account.status && account.status.toString() === 'ACTIVATED' ? 'bi-pause-circle' : 'bi-play-circle'"></i>
                  {{ account.status && account.status.toString() === 'ACTIVATED' ? 'SUSPEND ACCOUNT' : 'ACTIVATE ACCOUNT' }}
                </button>

                <button type="button" class="btn btn-primary btn-sm py-3 fw-bold shadow-sm d-flex align-items-center justify-content-center"
                        (click)="handleAccountOperations()"
                        [disabled]="account.status && account.status.toString() !== 'ACTIVATED'"
                        [title]="account.status && account.status.toString() !== 'ACTIVATED' ? 'Operations are disabled for ' + account.status + ' accounts' : 'View all operations'">
                  <i class="bi bi-cash-stack me-2 fs-5"></i> VIEW ALL OPERATIONS
                </button>
              </div>

              <div class="mt-4 text-center">
                <p class="extra-small text-muted mb-0">Safety first: suspending an account prevents any incoming or outgoing transactions instantly.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template #loadingOrError>
    <div *ngIf="errorMessage" class="alert alert-danger border-0 shadow-sm mx-auto mt-4" style="max-width: 600px;">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>{{errorMessage}}
    </div>
    <div *ngIf="!errorMessage" class="text-center py-5">
      <div class="spinner-border text-primary spinner-border-sm" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3 text-muted small">Synchronizing with ledger...</p>
    </div>
  </ng-template>
</div>
